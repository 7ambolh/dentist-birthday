<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Musical Extraction</title>
    <style>
        body {
            background-color: #f0faff;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            perspective: 1000px;
        }

        .container {
            text-align: center;
            background: white;
            padding: 60px;
            border-radius: 50px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.08);
            width: 400px;
            z-index: 10;
            position: relative;
        }

        /* Tooth & Animation Area */
        .extraction-zone {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto 40px;
            cursor: pointer;
        }

        .tooth-shard {
            position: absolute;
            font-size: 120px;
            width: 100%;
            height: 100%;
            transition: all 0.7s cubic-bezier(0.6, -0.28, 0.735, 0.045);
            user-select: none;
            left: 0;
        }

        .cake {
            position: absolute;
            top: 15%;
            left: 0;
            width: 100%;
            font-size: 100px;
            opacity: 0;
            transform: scale(0) rotate(-20deg);
            transition: all 0.6s 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .broken .shard-left { transform: translateX(-150px) translateY(-50px) rotate(-60deg); opacity: 0; }
        .broken .shard-right { transform: translateX(150px) translateY(-50px) rotate(60deg); opacity: 0; }
        .broken .cake { 
            opacity: 1; 
            transform: scale(1.4) rotate(0deg); 
            animation: celebrate 1s infinite alternate 1s; 
        }

        @keyframes celebrate {
            from { transform: scale(1.3) translateY(0); }
            to { transform: scale(1.5) translateY(-15px); }
        }

        /* Text Styles */
        h1 { color: #008ece; margin: 15px 0; font-size: 28px; }
        p { color: #777; font-size: 18px; margin-bottom: 30px; }
        
        .status-badge {
            background: #e1f5fe;
            color: #0288d1;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
            display: inline-block;
        }

        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            z-index: 1;
        }

        /* Button to go to the next page */
        #reportBtn {
            display: none;
            background: #ff5722;
            color: white;
            text-decoration: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: 0.3s;
            margin-top: 10px;
        }

        #reportBtn:hover { transform: translateY(-3px); background: #e64a19; }

    </style>
</head>
<body>

    <div class="container" id="mainCard">
        <div style="font-size: 12px; color: #999; margin-bottom: 10px;">ðŸ”Š TURN SOUND ON</div>
        <div class="status-badge" id="badge">Patient: Birthday Boy</div>
        
        <div class="extraction-zone" onclick="performExtraction()">
            <div class="tooth-shard shard-left">ðŸ¦·</div>
            <div class="tooth-shard shard-right">ðŸ¦·</div>
            <div class="cake">ðŸŽ‚</div>
        </div>

        <h1 id="title">Click to Start Procedure</h1>
        <p id="desc">Careful! This requires precision.</p>
        
        <a href="file22.html" id="reportBtn">ðŸ“„ View Clinical Report</a>
    </div>

    <script>
        let audioCtx;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playNote(freq, duration, type = 'sine') {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playBirthdayTune() {
            const notes = [
                {f: 261, d: 0.3}, {f: 261, d: 0.3}, {f: 293, d: 0.5}, 
                {f: 261, d: 0.5}, {f: 349, d: 0.5}, {f: 329, d: 0.8}
            ];
            notes.forEach((n, i) => {
                setTimeout(() => playNote(n.f, n.d), i * 400);
            });
        }

        function performExtraction() {
            initAudio(); // Must initialize audio on user click
            const card = document.getElementById('mainCard');
            const badge = document.getElementById('badge');
            const title = document.getElementById('title');
            const desc = document.getElementById('desc');
            const btn = document.getElementById('reportBtn');

            if (!card.classList.contains('broken')) {
                card.classList.add('broken');
                badge.innerText = "Procedure Successful!";
                badge.style.background = "#c8e6c9";
                badge.style.color = "#2e7d32";
                title.innerText = "HAPPY BIRTHDAY!";
                desc.innerText = "No drilling, just chilling.";
                
                // Audio
                playNote(150, 0.1, 'sawtooth'); // Crack sound
                setTimeout(playBirthdayTune, 500);
                
                spawnConfetti();
                
                // Show the report button after 2 seconds
                setTimeout(() => {
                    btn.style.display = 'inline-block';
                }, 2000);
            }
        }

        function spawnConfetti() {
            for (let i = 0; i < 80; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = '50%';
                confetti.style.top = '50%';
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0%';
                document.body.appendChild(confetti);

                const destinationX = (Math.random() - 0.5) * window.innerWidth;
                const destinationY = (Math.random() - 0.5) * window.innerHeight;

                confetti.animate([
                    { transform: 'translate(-50%, -50%) scale(0)', opacity: 1 },
                    { transform: `translate(${destinationX}px, ${destinationY}px) rotate(${Math.random() * 720}deg) scale(1)`, opacity: 0 }
                ], {
                    duration: 2500 + Math.random() * 1000,
                    easing: 'cubic-bezier(0.1, 0.8, 0.3, 1)',
                    fill: 'forwards'
                });
            }
        }
    </script>
</body>
</html>